<?xml version="1.0"?>

<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">

		<p:fieldset id="compositeDefFieldSet">
			<h:message for="@form"></h:message>
			<p:fieldset id="dashboardFieldSet">
				<c:if test="#{(editToolDefBacking.getCompositeStepDef().hasSteps())}">
					<p:dashboard id="DB#{compositeStepDefBacking.getStepDefDBEId()}" model="#{editToolDefBacking.dashboard}" widgetVar="naniero">
						<p:ajax event="reorder" listener="#{compositeStepDefBacking.reorderStepDef}" />
						<c:forEach var="index" begin="0" end="#{compositeStepDefBacking.getStepsNumber() - 1}">
							<p:panel id="Panel_#{index}" widgetVar="Panel_#{index}" header="Step #{index + 1}. Type: #{compositeStepDefBacking.getStepType(index)}">
								<f:facet name="actions">
									<h:commandLink styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default">
										<p:ajax oncomplete="PF('confDialogPanel_#{index}').show();"/>
										<h:outputText styleClass="ui-icon ui-icon-close" />
									</h:commandLink>
								</f:facet>
								<h:outputText value="${i18n['Step']}: " />
								<h:outputText id="Panel_#{index}_stepName" value="#{compositeStepDefBacking.getStepName(index)}#{compositeStepDefBacking.getStepDefDBEId(index)}" />
								<br />
								<p:commandButton id="configStep#{index}Button" value="#{i18n['configureStep']}" action="#{editToolDefBacking.configStepDialog(index)}">
									<p:ajax event="dialogReturn" update="compositeStepsForm" listener="#{editToolDefBacking.returnFromConfigStep}" />
								</p:commandButton>
							</p:panel>
						</c:forEach>
					</p:dashboard>
				</c:if>
				<c:if test="#{!(editToolDefBacking.getCompositeStepDef().hasSteps())}">
					<h:outputText value="#{i18n['no-steps-yet']}"/>
				</c:if>
			</p:fieldset>
			<p:commandButton id="newStepButton" value="#{i18n['new-step']}" action="#{stepTypeListBacking.chooseStepDef}">
				<p:ajax event="dialogReturn" update="compositeStepsForm" listener="#{editToolDefBacking.createNewStepDef}" />
			</p:commandButton>
			<p:commandButton id="orderSteps" value="#{i18n['save-order-steps']}" rendered="#{(editToolDefBacking.getCompositeStepDef().hasSteps())}">
				<p:ajax update="dashboardFieldSet" listener="#{compositeStepDefBacking.saveNewStepsOrder}" />
			</p:commandButton>
		</p:fieldset>
		<c:if test="#{(editToolDefBacking.getCompositeStepDef().hasSteps())}">
			<c:forEach var="index" begin="0" end="#{compositeStepDefBacking.getStepsNumber() - 1}">
				<p:dialog widgetVar="confDialogPanel_#{index}" header="Naniero" modal="true" draggable="false" resizable="false">
					<h:outputText value="#{i18n['ask-delete-step']}" />
					<br />
					<h:outputText value="#{i18n['order-changes-will-save']}"/>
					<p />
					<p:commandButton id="confirmDelete_#{index}" value="#{i18n['yes']}">
						<p:ajax update="dashboardFieldSet" listener="#{compositeStepDefBacking.deleteStepDef(index)}" oncomplete="PF('confDialogPanel_#{index}').hide();"/>
					</p:commandButton>
					<p:commandButton id="denyDelete_#{index}" value="#{i18n['no']}" onclick="PF('confDialogPanel_#{index}').hide();"/>
				</p:dialog>
			</c:forEach>
		</c:if>
</f:view>